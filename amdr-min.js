/* AMDR 1.0 (sha1: 198b06ca455ffa6e2698eabe0c4266948a21ce7e) | (c) 2012 Shen Junru. MIT License. | http://github.com/shenjunru/amdr */
(function(e,t,n){"use strict";function H(e){return e instanceof Array}function B(e){return"function"==typeof e}function j(e){return"string"==typeof e}function F(e){return"object"==typeof e}function I(e,t){if(t){var n,r;for(n in t)D.call(t,n)&&(r=t[n],H(r)?r=r.concat():F(r)&&(r=I(I({},e[n]),r)),e[n]=r)}return e}function q(e,t){var n=new Error(e);return g.debug&&!t&&setTimeout(function(){throw n},0),n}function R(){return q("promise fulfilled.",!0)}function U(e){return r.getElementsByTagName(e)[0]}function z(e,t){var n=r.createElement("script");e.padding=!1,p[e.name]=n,l&&(m[e.name]=[]),n[o]=f?function(){W(e,n)}:function(){h[n.readyState]&&W(e,n)},n[u]=function(){W(e,n,q("load failure."))},n.charset="utf-8",n.async=n.defer=!0,n.type="text/javascript",n.src=t||nt(e.name,e.context.config),i.appendChild(n)}function W(t,n,r){n[u]=n[o]="",delete p[t.name];if(r)t.reject(r);else{var i,s=m;l&&(s=s[t.name]);while(s.length)i=s.shift(),i.push(t),lt.apply(e,i);l&&delete s[t.name],t.defined||(t.defined=!0,t.resolve())}}function X(){}function V(e){var t=this;t.config={},t.urlBase="",t.urlArgs="",t.pathNow=e||"",t.pathMap={},t.timeout=7,t.debug=!1}function $(e){var t=this,r=new Q;t.resolve=r.resolve,t.reject=r.reject,t.promise=r.promise,t.config=e,t.rejected=!1,t.requires={},t.exports=n,t.module=n}function J(e,t){var n=this,r=new Q;t=t.clone(),t.pathNow=e.replace(k,"$1"),n.resolve=r.resolve,n.reject=r.reject,n.promise=r.promise,n.context=new $(t),n.defined=!1,n.padding=!0,n.name=e}function K(e){this.then=e}function Q(){var e=this,t=new K,r=[],i=[],s="pending",o=function(t,n,s){var o=e;if(t||n)o=new Q,r.push(function(e){e.then(t,n).then(o.resolve,o.reject)});return B(s)&&i.push(s),o.promise},u=function(e){var t,i;e=G(e),o=e.then;for(t=0,i=r.length;t<i;t++)r[t](e);return u=r=n,e};e.promise=t,e.then=t.then=function(e,t,n){return o(e,t,n)},e.resolve=function(e){if(u)return s="resolved",u(e);throw R()},e.reject=function(e){if(u)return s="rejected",u(Z(e));throw R()},e.notify=function(e){if(!u)throw R();for(var t=0,n=i.length;t<n;t++)i[t](e)},e.state=function(){return s}}function G(e){return e instanceof K?e:Y(e)}function Y(e){return new K(function(t){try{return G(t?t(e):e)}catch(n){return Z(n)}})}function Z(e){return new K(function(t,n){try{return n?G(n(e)):Z(e)}catch(r){return Z(r)}})}function et(e,t,n,r){return G(e).then(t,n,r)}function tt(e,t){var n=e.lastIndexOf("."),r="";return-1!==n&&(r=e.substring(n,e.length),e=e.substring(0,n)),e=it(e,t),nt(e,t,r)}function nt(e,t,n){var r=e;return N.test(r)||(r+=n||".js"),t.urlBase&&!x.test(e)&&(r=t.urlBase+r),t.urlArgs&&(r+=(A.test(r)?"&":"?")+t.urlArgs),r}function rt(e){do e=e.replace(C,M);while(e.indexOf("/./")>-1);var t,n=1,r=e.split(M);while(0<(t=P.call(r,"..",n)))O.test(r[t-=1])?n++:r.splice(t,2);return r.join(M)}function it(e,t){if(!e)return e;if(!x.test(e)){if(!T.test(e)){var n=t.pathMap,r,i,s;if(n){r=e.split(M);for(s=r.length;s>0;s--){i=r.slice(0,s).join(M);if(D.call(n,i)){(i=n[i])?r.splice(0,s,i):r.splice(0,s);break}}e=r.join(M)}}else t.pathNow&&(e=t.pathNow+e);0===e.indexOf("./")&&(e=e.substring(2))}return rt(e)}function st(e,t){var n=e?e.indexOf("!"):-1,r;return-1!==n&&(r=e.substring(n+1,e.length),e=e.substring(0,n)),{name:it(e,t),pipe:r}}function ot(e){for(e in p)if(c===h[p[e].readyState])return v[e]}function ut(e,t){function u(e,t,n){return n&&r.push(n),e}var r=[],i=0,s,o;while(-1<(i=P.call(e,"require",i)))n===s&&(s=String(t).replace(E,""),o=s.replace(w,"$1").replace(b,"").split(y)),s.replace(new RegExp(o[i]+S,"g"),u),i++;return r}function at(e,t,r){function l(e){return{index:r,exports:e}}function c(t){if(!e.rejected)throw e.rejected=!0,t}if(t in d)return Y(d[t](e)).then(l);var i=isNaN(r)&&r,s=st(t,e.config),o=s.pipe,u,a,f;return(t=s.name)?(u=e.getModule(t),a=u.promise,n!==o&&(f=new Q,a.then(function(t){t&&t.load?(t.normalize?o=t.normalize(o,function(t){return it(t,e.config)}):o=it(o,e.config),at(e,o,t).then(f.resolve,f.reject)):f.reject(q('"load()" undefined.'))},f.reject),a=f.promise),i?(u.padding&&(u.padding=!1,i.load(t,{resolve:u.resolve,reject:u.reject,config:function(){return u.context.config},load:function(e){z(u,e)},toUrl:function(e,t){return tt(e,t||this.config())}})),a):(u.padding&&z(u),a.then(l,c))):Z(q("module name empty.")).then(c)}function ft(e,t,n){function c(t){(j(t.index)?e.requires:r)[t.index]=t.exports,0===--f&&!o&&(o=!0,e.resolve(r))}function h(t){i=!1,o||(o=!0,e.reject(t))}function p(){o||(o=!0,e.reject(q("context timeout.")))}var r=[],i=!0,s=t.length,o=!1,u,a,f,l;n&&n.length&&(t=t.concat(n));if(f=a=t.length){r.length=s;for(u=0;i&&u<a;u++)(l=t[u])&&at(e,l,u<s?u:l).then(c,h);setTimeout(p,1e3*e.config.timeout)}else e.resolve(r);return e.promise}function lt(t,r,i,s,o){function a(t){try{var r=s.apply(e,t),i=u.exports,a=u.module;a=a&&a.exports}catch(f){o.reject(f)}n!==a&&i!==a?r=a:n===r&&i&&(r=i),o.resolve(r)}function f(e){o.reject(e)}var u=o.context;t=it(t,u.config),t&&t!==o.name&&(o=u.getModule(t),u=o.context);if(o.defined)return;o.defined=!0,o.padding=!1,ft(u,r,i).then(a,f)}function ct(e,t,n){var r=arguments.length,i=_,s,o,u,a;2===r?(j(e)?o=e:i=e,n=t):1===r?n=e:3===r&&(o=e,i=t),B(n)?(_===i&&!n.length&&(i=""),i=i&&String(i).replace(b,""),i=i?i.split(y):[],u=n,u.length&&(s=ut(i,u))):(i=[],u=function(){return n}),l?(a=ot(),m[a.name].push([o,i,s,u])):m.push([o,i,s,u])}function ht(t,r,i){t=String(t).replace(b,"").split(y);var s=new $(g),o;return B(r)?o=ut(t,r):r=n,ft(s,t,o).then(function(t){return r&&r.apply(e,t)},i)}function pt(e){return function(t){return e.requires[t]}}function dt(e){return e.exports||(e.exports={})}function vt(e){return e.module||(e.module={exports:dt(e),config:function(){return e.config.config},toUrl:function(t,n){return tt(t,n||e.config)}})}var r=e.document,i=U("head")||U("script"),s=r.createElement("script"),o="onload",u="onerror",a="readyState",f=o in s||!(a in s),l=!f,c={},h={interactive:c,loaded:1,complete:1},p={},d={},v={},m=l?{}:[],g=new V,y=/\s*,\s*/g,b=/^\s+|\s+$/g,w=/^\S+(?:\s*|\s+\S+\s*)\(([^\)]*)\)[\s\S]+$/,E=/\/\*([\s\S]*?)\*\/|\/\/(.*)$/mg,S=/\s*\((['"])([^'"\(]+)\1\)/.source,x=/^\/|^[^:]+:\/\//,T=/^\.?\.\//,N=/\?|\.js$/,C=/\/\.\//g,k=/(\/?)[^\/]*$/,L=/\/$/,A=/\?/,O=/\.\.?/,M="/",_="require,exports,module",D=Object.prototype.hasOwnProperty,P=Array.prototype.indexOf||function(e,t){var n=this.length;t=t?t<0?Math.max(0,n+t):t:0;for(;t<n;t++)if(t in this&&e===this[t])return t;return-1};l&&(o="onreadystatechange"),l=t||l,(X.prototype=V.prototype).clone=function(){var e=new X;return I(e,this),e},$.prototype.getModule=function(e){return v[e]||(v[e]=new J(e,this.config))},K.prototype.always=function(e){return this.then(e,e)},ct.amd={version:"%VERSION%",jQuery:!0},ht.config=function(e){if(e){var t=e.urlBase,n=e.pathMap,r;t&&!L.test(t)&&(e.urlBase+="/");if(n)for(r in n)n[r]=rt(n[r].replace(L,""));I(g,e)}return g},d.require=pt,d.exports=dt,d.module=vt,d.isIE=function(){return t},d.Promise=function(){return K},d.Deferred=function(){return Q},K.resolve=G,K.resolved=Y,K.rejected=Z,K.when=et,e.define=ct,e.require=ht})(this,/*@cc_on!@*/!1);
